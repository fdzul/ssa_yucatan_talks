---
format: 
  revealjs:
    #theme: ["theme/q-theme.scss"]
    slide-number: c/t
    logo: "https://salud.yucatan.gob.mx/files/get/2889?v=1669754780"
    footer: "[github.com/fdzul](https://joyful-palmier-ec5e33.netlify.app/talks/reunion_interstatal/#/)"
    center-title-slide: true
highlight-style: a11y
---

<h2>Plan Interestatal de Prevención y Control del Dengue<br>en Yucatán</h2>

<h2> </h2>

<hr>

<h3> Felipe Dzul Manzanilla </h3><h3>Jorge Palacios</h3> <h3></h3>

<h4> 2023-04-05 </h4>
<br>

<h4> `r fontawesome::fa("github", "black")` &nbsp; [github.com/fdzul](https://fdzul.github.io/web_site_fadm/)


![](chains_merida.jpg){.absolute top=155 left="550" width="750"}

```{r setup}
path_arbo <- "/Users/fdzul/Library/CloudStorage/OneDrive-Personal/datasets/DGE/arbo/"
# 3.1 arbovirosis dataset
x <- boldenr::read_dataset_bol(path = path_arbo,
                                dataset = "sinave")
source("~/Dropbox/r_developments/r_new_functions/3.Functions/static_bump_map.R")
library(sf)
```

## <span style="color:#003300;">Panorama Epidemiológico</span>
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r}
library(dplyr)
rank_cases <- function(x){
    x |>
        dplyr::arrange(dplyr::desc(value)) |>
        dplyr::mutate(rank = 1:dplyr::n())
}


# Step 1. load the dengue dataset 2008 to 2015 ####
load("~/Library/CloudStorage/OneDrive-Personal/automatic_read_sinave/8.RData/den/den2008_2022.RData")

z <- den2008_2015  |>
    dplyr::filter(!DES_EDO.x %in% c("OTROS PAISES", 
                                      "OTROS PAISES DE LATINOAMERICA",
                                      "ESTADOS UNIDOS DE NORTEAMERICA")) |>
    dplyr::filter(DES_DIAG_FINAL %in% c("FIEBRE HEMORRAGICA POR DENGUE", "FIEBRE POR DENGUE")) |>
    dplyr::group_by(DES_EDO.x, ANO) |>
    dplyr::summarise(value = dplyr::n(), .groups = "drop") |>
    as.data.frame() |>
    dplyr::group_by(ANO) |>
    dplyr::rename(DES_EDO_RES = DES_EDO.x) |>
    dplyr::mutate(CVE_EDO_RES = DES_EDO_RES) |>
    #dplyr::mutate(rank = rank(value, ties.method = "random"))|> 
    tidyr::nest() |>
    dplyr::mutate(rank = purrr::map(data,
                                    rank_cases)) |>
    dplyr::select(-data) |>
    tidyr::unnest(cols = c(rank)) |>
    dplyr::mutate(ANO = as.numeric(ANO)) |>
    as.data.frame()

y <- den2016_2022 |>
    dplyr::filter(!DES_EDO_RES %in% c("OTROS PAISES", 
                                      "OTROS PAISES DE LATINOAMERICA",
                                      "ESTADOS UNIDOS DE NORTEAMERICA")) |>
    dplyr::filter(DES_DIAG_FINAL %in% 
                      c("DENGUE CON SIGNOS DE ALARMA", 
                        "DENGUE NO GRAVE", 
                        "DENGUE GRAVE")) |>
    dplyr::group_by(DES_EDO_RES, ANO) |>
    dplyr::summarise(value = dplyr::n(), .groups = "drop") |>
    dplyr::group_by(ANO) |>
    dplyr::mutate(CVE_EDO_RES = DES_EDO_RES) |>
    #dplyr::mutate(rank = rank(value, ties.method = "random"))|> 
    tidyr::nest() |>
    dplyr::mutate(rank = purrr::map(data,
                                    rank_cases)) |>
    dplyr::select(-data) |>
    tidyr::unnest(cols = c(rank)) |>
    dplyr::mutate(ANO = as.numeric(ANO)) |>
    as.data.frame()


w <-  boldenr::read_dataset_bol(path = "~/Library/CloudStorage/OneDrive-Personal/datasets/DGE/arbo/",
                                     dataset = "sinave")  |>
    dplyr::filter(!DES_EDO_RES %in% c("OTROS PAISES", 
                                      "OTROS PAISES DE LATINOAMERICA",
                                      "ESTADOS UNIDOS DE NORTEAMERICA")) |>
    dplyr::filter(DES_DIAG_FINAL %in% 
                      c("DENGUE CON SIGNOS DE ALARMA", 
                        "DENGUE NO GRAVE", 
                        "DENGUE GRAVE")) |>
    dplyr::group_by(DES_EDO_RES, ANO) |>
    dplyr::summarise(value = dplyr::n(), .groups = "drop") |>
    dplyr::group_by(ANO) |>
    dplyr::mutate(CVE_EDO_RES = DES_EDO_RES) |>
    #dplyr::mutate(rank = rank(value, ties.method = "random"))|> 
    tidyr::nest() |>
    dplyr::mutate(rank = purrr::map(data,
                                    rank_cases)) |>
    dplyr::select(-data) |>
    tidyr::unnest(cols = c(rank)) |>
    dplyr::mutate(ANO = as.numeric(ANO)) |>
    as.data.frame()

zyw <- dplyr::bind_rows(z, y, w)

col <- viridis::magma(n = length(unique(zyw$CVE_EDO_RES)))
col[31]  <- "#2EB67D"


ggplot2::ggplot(data = zyw,
                ggplot2:::aes(ANO, 
                              rank, 
                              color = CVE_EDO_RES)) +
    ggplot2::geom_point(size = 4) +
    ggplot2::geom_text(data = zyw |> 
                           dplyr::filter(ANO == min(ANO)),
                       ggplot2::aes(x = ANO - .1, 
                                    label = CVE_EDO_RES), 
                       size = 1.5, 
                       nudge_x = -0.1,
                       hjust = 1) +
    ggplot2::geom_text(data = zyw |> 
                           dplyr::filter(ANO == max(ANO)),
                       ggplot2::aes(x = ANO + .1, 
                                    label = CVE_EDO_RES), 
                       size = 1.5, 
                       nudge_x = 0.1,
                       hjust = 0) +
    ggbump::geom_bump(size = 3, smooth = 8) +
    ggplot2::scale_x_continuous(breaks = seq(1, max(zyw$ANO), 1)) +
    cowplot::theme_minimal_grid(font_size = 14, 
                                line_size = 0) +
    ggplot2::theme(legend.position = "none",
                   panel.grid.major = ggplot2::element_blank()) +
    ggplot2::labs(y = "Posición de Casos Confirmados de Dengue",
                  x = "") +
    ggplot2::scale_y_reverse() +
    ggplot2::scale_color_manual(values = col)
```


## <span style="color:#003300;">Panorama Epidemiológico</span>
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

:::{.column}

![](wavelet_analysis.png){.absolute top=100 width="800" height="550" right=120}

:::

## <span style="color:#003300;">Panorama Epidemiológico</span>
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

::: {.panel-tabset}

### 2022
```{r bump_map_mun_2022}
library(sf)
static_bump_map(dataset = x,
                year = "2022",
                state = FALSE,
                cve_edo = "31",
                country_text_x = .01,
                country_text_y = 0.024,
                axis_start = 1,
                value_text = 0.37,
                size_text_value = 4,
                line_size = 2,
                size_text_country = 4,
                pal_vir = "viridis") +
    ggplot2::coord_sf(xlim = c(-90.5, -86))
```

### 2023

```{r bump_map_mun_2023}
static_bump_map(dataset = x,
                year = "2023",
                state = FALSE,
                cve_edo = "31",
                country_text_x = .01,
                country_text_y = 0.024,
                axis_start = 1,
                value_text = 0.37,
                size_text_value = 4,
                line_size = 2,
                size_text_country = 4,
                pal_vir = "viridis") +
    ggplot2::coord_sf(xlim = c(-90.5, -86))
```

:::

## <span style="color:#003300;">Panorama Epidemiológico</span>
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

&nbsp;

```{r casos_semana_mpo}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_confirmados.R")
library(ggplot2)
heatmap_confirmados(dataset = x, 
                    year = 2023, 
                    size_text = 3,
                    state = "YUCATAN",
                    JS = FALSE,
                    MPO = TRUE,
                    EDO = FALSE)
```


## <span style="color:#003300;">Vigilancia Entomológica</span>
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r indicador_ovitrampas_by_ovitrap,fig.align = "center"}
source("~/Dropbox/r_developments/r_new_functions/3.Functions/ovitraps_occupancy_abundancy.R")

path_vect <- "/Users/fdzul/Library/CloudStorage/OneDrive-Personal/datasets/CENAPRECE/2023/31_yucatan"
ovitraps_occupancy_abundancy(ovitraps_path = path_vect,
                             scale = "ovitraps")

```




## <span style="color:#003300;">Dios Botic</span>
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">
&nbsp;

- ***Bio*** : https://fdzul.github.io/web_site_fadm/

- ***email***       :     [felipe.dzul.m@gmail.com]()

- ***celular***     :     [8139945623]()

- ***slides***:     https://joyful-palmier-ec5e33.netlify.app/talks/reunion_interstatal/#/